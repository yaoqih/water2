{
   "annotations": {
      "list": [
         {
            "builtIn": 1,
            "datasource": {
               "type": "grafana",
               "uid": "-- Grafana --"
            },
            "enable": true,
            "hide": true,
            "iconColor": "rgba(0, 211, 255, 1)",
            "name": "Annotations & Alerts",
            "type": "dashboard"
         }
      ]
   },
   "editable": true,
   "id": 8,
   "panels": [
      {
         "gridPos": {
            "h": 2,
            "w": 24,
            "x": 0,
            "y": 0
         },
         "id": 1,
         "libraryPanel": {
            "name": "IoT Viewer Navigation",
            "uid": "lib_iot_view_nav"
         },
         "options": {
            "content": "[ğŸ  æ€»è§ˆ](/d/iot-v1-admin-home) Â· [ğŸ§¾ å¯¼å‡º](/d/iot-v1-admin-export) Â· [ğŸ“ˆ ç›‘æµ‹å¤§å±](/d/iot-v1-plant-monitor)",
            "mode": "markdown"
         },
         "title": "å¯¼èˆª",
         "type": "text"
      },
      {
         "gridPos": {
            "h": 1,
            "w": 24,
            "x": 0,
            "y": 2
         },
         "id": 111,
         "options": {
            "content": "ğŸŸ¨ **å…¥å£å®æ—¶ï¼ˆé»„è‰²ï¼‰**",
            "mode": "markdown"
         },
         "title": "å…¥å£æ ‡è¯†",
         "type": "text"
      },
      {
         "datasource": "TimescaleDB-RO",
         "fieldConfig": {
            "defaults": {
               "color": {
                  "fixedColor": "#F2CC0C",
                  "mode": "fixed"
               },
               "links": [
                  {
                     "targetBlank": false,
                     "title": "åˆ‡æ¢å½“å‰æŒ‡æ ‡",
                     "url": "/d/iot-v1-plant-monitor?var-plant_id=${plant_id:percentencode}&var-metric=${metric_cards:percentencode}&var-agg=${agg:percentencode}"
                  }
               ],
               "thresholds": {
                  "mode": "absolute",
                  "steps": [
                     {
                        "color": "#F2CC0C",
                        "value": null
                     }
                  ]
               }
            },
            "overrides": [ ]
         },
         "gridPos": {
            "h": 3,
            "w": 1,
            "x": 0,
            "y": 3
         },
         "id": 11,
         "maxPerRow": 24,
         "options": {
            "colorMode": "value",
            "graphMode": "none",
            "justifyMode": "auto",
            "orientation": "auto",
            "reduceOptions": {
               "calcs": [
                  "lastNotNull"
               ],
               "fields": "",
               "values": false
            },
            "textMode": "value"
         },
         "repeat": "metric_cards",
         "repeatDirection": "h",
         "targets": [
            {
               "format": "table",
               "rawQuery": true,
               "rawSql": "WITH latest AS (\n  SELECT m.ingest_ts, m.value_num, m.device_id\n  FROM metric_sample m\n  WHERE m.plant_id = ${plant_id:sqlstring}\n    AND m.point_id = ${inlet_point_id:sqlstring}\n    AND m.metric = ${metric_cards:sqlstring}\n  ORDER BY m.ingest_ts DESC\n  LIMIT 1\n)\nSELECT round(l.value_num::numeric, 3) AS value\nFROM latest l\nLEFT JOIN device d ON d.device_id = l.device_id\nWHERE l.ingest_ts >= now() - ((2 * COALESCE(d.report_interval_sec, 60)) * interval '1 second');",
               "refId": "A"
            }
         ],
         "title": "${metric_cards:text}",
         "type": "stat"
      },
      {
         "gridPos": {
            "h": 1,
            "w": 24,
            "x": 0,
            "y": 6
         },
         "id": 112,
         "options": {
            "content": "ğŸŸ© **å‡ºå£å®æ—¶ï¼ˆç»¿è‰²ï¼‰**",
            "mode": "markdown"
         },
         "title": "å‡ºå£æ ‡è¯†",
         "type": "text"
      },
      {
         "datasource": "TimescaleDB-RO",
         "fieldConfig": {
            "defaults": {
               "color": {
                  "fixedColor": "#73BF69",
                  "mode": "fixed"
               },
               "links": [
                  {
                     "targetBlank": false,
                     "title": "åˆ‡æ¢å½“å‰æŒ‡æ ‡",
                     "url": "/d/iot-v1-plant-monitor?var-plant_id=${plant_id:percentencode}&var-metric=${metric_cards:percentencode}&var-agg=${agg:percentencode}"
                  }
               ],
               "thresholds": {
                  "mode": "absolute",
                  "steps": [
                     {
                        "color": "#73BF69",
                        "value": null
                     }
                  ]
               }
            },
            "overrides": [ ]
         },
         "gridPos": {
            "h": 3,
            "w": 1,
            "x": 0,
            "y": 7
         },
         "id": 12,
         "maxPerRow": 24,
         "options": {
            "colorMode": "value",
            "graphMode": "none",
            "justifyMode": "auto",
            "orientation": "auto",
            "reduceOptions": {
               "calcs": [
                  "lastNotNull"
               ],
               "fields": "",
               "values": false
            },
            "textMode": "value"
         },
         "repeat": "metric_cards",
         "repeatDirection": "h",
         "targets": [
            {
               "format": "table",
               "rawQuery": true,
               "rawSql": "WITH latest AS (\n  SELECT m.ingest_ts, m.value_num, m.device_id\n  FROM metric_sample m\n  WHERE m.plant_id = ${plant_id:sqlstring}\n    AND m.point_id = ${outlet_point_id:sqlstring}\n    AND m.metric = ${metric_cards:sqlstring}\n  ORDER BY m.ingest_ts DESC\n  LIMIT 1\n)\nSELECT round(l.value_num::numeric, 3) AS value\nFROM latest l\nLEFT JOIN device d ON d.device_id = l.device_id\nWHERE l.ingest_ts >= now() - ((2 * COALESCE(d.report_interval_sec, 60)) * interval '1 second');",
               "refId": "A"
            }
         ],
         "title": "${metric_cards:text}",
         "type": "stat"
      },
      {
         "gridPos": {
            "h": 2,
            "w": 8,
            "x": 0,
            "y": 40
         },
         "id": 115,
         "options": {
            "content": "å‡å€¼åˆ†é¡µï¼šç¬¬ **${mean_page}/${mean_page_total}** é¡µï¼ˆæ¯é¡µ 5 ä¸ªæŒ‡æ ‡ï¼‰ã€‚[â® é¦–é¡µ](/d/iot-v1-plant-monitor?var-plant_id=${plant_id:percentencode}&var-metric=${metric:percentencode}&var-agg=${agg:percentencode}&var-mean_page=1) Â· [â—€ ä¸Šä¸€é¡µ](/d/iot-v1-plant-monitor?var-plant_id=${plant_id:percentencode}&var-metric=${metric:percentencode}&var-agg=${agg:percentencode}&var-mean_page=${mean_page_prev:percentencode}) Â· [ä¸‹ä¸€é¡µ â–¶](/d/iot-v1-plant-monitor?var-plant_id=${plant_id:percentencode}&var-metric=${metric:percentencode}&var-agg=${agg:percentencode}&var-mean_page=${mean_page_next:percentencode}) Â· [æœ«é¡µ â­](/d/iot-v1-plant-monitor?var-plant_id=${plant_id:percentencode}&var-metric=${metric:percentencode}&var-agg=${agg:percentencode}&var-mean_page=${mean_page_total:percentencode})",
            "mode": "markdown"
         },
         "title": "å‡å€¼åˆ†é¡µ",
         "type": "text"
      },
      {
         "datasource": "TimescaleDB-RO",
         "fieldConfig": {
            "defaults": {
               "custom": {
                  "drawStyle": "line",
                  "fillOpacity": 10,
                  "lineInterpolation": "smooth",
                  "lineWidth": 2,
                  "pointSize": 3,
                  "showPoints": "always",
                  "spanNulls": true
               }
            },
            "overrides": [
               {
                  "matcher": {
                     "id": "byName",
                     "options": "å…¥å£"
                  },
                  "properties": [
                     {
                        "id": "color",
                        "value": {
                           "fixedColor": "#F2CC0C",
                           "mode": "fixed"
                        }
                     }
                  ]
               },
               {
                  "matcher": {
                     "id": "byName",
                     "options": "å‡ºå£"
                  },
                  "properties": [
                     {
                        "id": "color",
                        "value": {
                           "fixedColor": "#73BF69",
                           "mode": "fixed"
                        }
                     }
                  ]
               }
            ]
         },
         "gridPos": {
            "h": 6,
            "w": 8,
            "x": 0,
            "y": 14
         },
         "hideTimeOverride": true,
         "id": 301,
         "links": [
            {
               "targetBlank": false,
               "title": "åˆ‡æ¢å½“å‰æŒ‡æ ‡",
               "url": "/d/iot-v1-plant-monitor?var-plant_id=${plant_id:percentencode}&var-metric=${mean_metric_page:percentencode}&var-agg=${agg:percentencode}&var-mean_page=${mean_page:percentencode}"
            }
         ],
         "maxPerRow": 1,
         "options": {
            "legend": {
               "calcs": [ ],
               "displayMode": "list",
               "placement": "bottom"
            },
            "tooltip": {
               "mode": "multi",
               "sort": "none"
            }
         },
         "repeat": "mean_metric_page",
         "repeatDirection": "v",
         "targets": [
            {
               "format": "time_series",
               "rawQuery": true,
               "rawSql": "SELECT\n  date_trunc('minute', m.ingest_ts) AS \"time\",\n  avg(CASE WHEN m.point_id = ${inlet_point_id:sqlstring} THEN m.value_num END) AS \"å…¥å£\",\n  avg(CASE WHEN m.point_id = ${outlet_point_id:sqlstring} THEN m.value_num END) AS \"å‡ºå£\"\nFROM metric_sample m\nWHERE m.plant_id = ${plant_id:sqlstring}\n  AND m.point_id IN (${inlet_point_id:sqlstring}, ${outlet_point_id:sqlstring})\n  AND m.metric IN (${mean_metric_page:sqlstring})\n  AND m.ingest_ts >= now() - interval '24 hours'\n  AND m.ingest_ts <= now()\nGROUP BY 1\nORDER BY 1;",
               "refId": "A"
            }
         ],
         "timeFrom": "now-24h",
         "title": "${mean_metric_page:text} å‡å€¼ï¼ˆæœ€è¿‘24hï¼‰",
         "type": "timeseries"
      },
      {
         "gridPos": {
            "h": 4,
            "w": 16,
            "x": 8,
            "y": 10
         },
         "id": 16,
         "options": {
            "content": "å½“å‰æŒ‡æ ‡ï¼š**${metric:text}** ï½œ å½“å‰å‘¨æœŸï¼š**${agg}**\n\n[5åˆ†é’Ÿ](/d/iot-v1-plant-monitor?var-plant_id=${plant_id:percentencode}&var-metric=${metric:percentencode}&var-agg=5min&var-mean_page=${mean_page:percentencode}&from=${__from}&to=${__to}) Â· [å°æ—¶](/d/iot-v1-plant-monitor?var-plant_id=${plant_id:percentencode}&var-metric=${metric:percentencode}&var-agg=hour&var-mean_page=${mean_page:percentencode}&from=${__from}&to=${__to}) Â· [å¤©](/d/iot-v1-plant-monitor?var-plant_id=${plant_id:percentencode}&var-metric=${metric:percentencode}&var-agg=day&var-mean_page=${mean_page:percentencode}&from=${__from}&to=${__to}) Â· [æœˆ](/d/iot-v1-plant-monitor?var-plant_id=${plant_id:percentencode}&var-metric=${metric:percentencode}&var-agg=month&var-mean_page=${mean_page:percentencode}&from=${__from}&to=${__to})\n\næŒ‡æ ‡åˆ‡æ¢ï¼š${metric_switch_md:raw}",
            "mode": "markdown"
         },
         "title": "èœ¡çƒ›å›¾å‘¨æœŸå¿«æ·é€‰æ‹©",
         "type": "text"
      },
      {
         "datasource": "TimescaleDB-RO",
         "fieldConfig": {
            "defaults": {
               "unit": "short"
            },
            "overrides": [
               {
                  "matcher": {
                     "id": "byName",
                     "options": "å‘Šè­¦ä¸‹é™çº¿"
                  },
                  "properties": [
                     {
                        "id": "color",
                        "value": {
                           "fixedColor": "#FF9830",
                           "mode": "fixed"
                        }
                     },
                     {
                        "id": "custom.drawStyle",
                        "value": "line"
                     },
                     {
                        "id": "custom.lineWidth",
                        "value": 2
                     },
                     {
                        "id": "custom.lineInterpolation",
                        "value": "linear"
                     },
                     {
                        "id": "custom.fillOpacity",
                        "value": 0
                     },
                     {
                        "id": "custom.showPoints",
                        "value": "never"
                     },
                     {
                        "id": "custom.axisPlacement",
                        "value": "right"
                     }
                  ]
               },
               {
                  "matcher": {
                     "id": "byName",
                     "options": "å‘Šè­¦ä¸Šé™çº¿"
                  },
                  "properties": [
                     {
                        "id": "color",
                        "value": {
                           "fixedColor": "#E02F44",
                           "mode": "fixed"
                        }
                     },
                     {
                        "id": "custom.drawStyle",
                        "value": "line"
                     },
                     {
                        "id": "custom.lineWidth",
                        "value": 2
                     },
                     {
                        "id": "custom.lineInterpolation",
                        "value": "linear"
                     },
                     {
                        "id": "custom.fillOpacity",
                        "value": 0
                     },
                     {
                        "id": "custom.showPoints",
                        "value": "never"
                     },
                     {
                        "id": "custom.axisPlacement",
                        "value": "right"
                     }
                  ]
               }
            ]
         },
         "gridPos": {
            "h": 10,
            "w": 16,
            "x": 8,
            "y": 14
         },
         "id": 4,
         "options": {
            "candleStyle": "candles",
            "colorStrategy": "open-close",
            "colors": {
               "down": "#B38B00",
               "up": "#F2CC0C"
            },
            "fields": {
               "close": "close",
               "high": "high",
               "low": "low",
               "open": "open"
            },
            "includeAllFields": true,
            "legend": {
               "calcs": [ ],
               "displayMode": "list",
               "placement": "bottom"
            },
            "mode": "candles",
            "tooltip": {
               "hoverProximity": 80,
               "maxHeight": 600,
               "maxWidth": 600,
               "mode": "single",
               "sort": "none"
            }
         },
         "targets": [
            {
               "format": "table",
               "rawQuery": true,
               "rawSql": "WITH tw AS (\n  SELECT '${__from:date:iso}'::timestamptz AS from_ts, LEAST('${__to:date:iso}'::timestamptz, now()) AS to_ts\n), base AS (\n  SELECT CASE ${agg:sqlstring}\n           WHEN '5min' THEN to_timestamp(floor(extract(epoch FROM m.ingest_ts) / 300) * 300)\n           ELSE date_trunc(CASE ${agg:sqlstring}\n                  WHEN 'hour' THEN 'hour'\n                  WHEN 'day' THEN 'day'\n                  WHEN 'month' THEN 'month'\n                  ELSE 'hour' END, m.ingest_ts)\n         END AS bucket_ts,\n         m.ingest_ts,\n         m.value_num\n  FROM metric_sample m\n  JOIN tw ON true\n  WHERE m.plant_id = ${plant_id:sqlstring}\n    AND m.metric = ${metric:sqlstring}\n    AND EXISTS (\n      SELECT 1 FROM metric_dict md\n      WHERE md.metric = m.metric\n        AND md.visible IS TRUE\n    )\n    AND m.point_id = ${inlet_point_id:sqlstring}\n    AND m.ingest_ts BETWEEN tw.from_ts AND tw.to_ts\n), ohlc AS (\n  SELECT bucket_ts,\n         CASE ${agg:sqlstring}\n           WHEN '5min' THEN bucket_ts + interval '5 minutes'\n           WHEN 'hour' THEN bucket_ts + interval '1 hour'\n           WHEN 'day' THEN bucket_ts + interval '1 day'\n           WHEN 'month' THEN bucket_ts + interval '1 month'\n           ELSE bucket_ts + interval '1 hour'\n         END AS bucket_end,\n         (array_agg(value_num ORDER BY ingest_ts ASC))[1] AS open,\n         max(value_num) AS high,\n         min(value_num) AS low,\n         (array_agg(value_num ORDER BY ingest_ts DESC))[1] AS close\n  FROM base\n  GROUP BY bucket_ts\n)\nSELECT (bucket_ts + ((bucket_end - bucket_ts) / 2.0)) AS \"time\",\n       COALESCE(open, close) AS open,\n       high,\n       low,\n       close\nFROM ohlc\nORDER BY \"time\";",
               "refId": "A"
            },
            {
               "format": "time_series",
               "rawQuery": true,
               "rawSql": "WITH tw AS (\n  SELECT '${__from:date:iso}'::timestamptz AS from_ts,\n         LEAST('${__to:date:iso}'::timestamptz, now()) AS to_ts\n), alarm AS (\n  SELECT md.alarm_low::double precision AS alarm_low,\n         md.alarm_high::double precision AS alarm_high\n  FROM metric_dict md\n  WHERE md.metric = ${metric:sqlstring}\n    AND md.visible IS TRUE\n  LIMIT 1\n)\nSELECT tw.from_ts AS \"time\",\n       alarm.alarm_low AS \"å‘Šè­¦ä¸‹é™çº¿\",\n       alarm.alarm_high AS \"å‘Šè­¦ä¸Šé™çº¿\"\nFROM tw\nJOIN alarm ON true\nUNION ALL\nSELECT tw.to_ts AS \"time\",\n       alarm.alarm_low AS \"å‘Šè­¦ä¸‹é™çº¿\",\n       alarm.alarm_high AS \"å‘Šè­¦ä¸Šé™çº¿\"\nFROM tw\nJOIN alarm ON true\nORDER BY 1;",
               "refId": "B"
            }
         ],
         "title": "å…¥å£èœ¡çƒ›å›¾ï¼ˆ${metric:text}ï½œå‘Šè­¦ä¸‹é™:${metric_alarm_low:text} ä¸Šé™:${metric_alarm_high:text}ï¼‰",
         "type": "candlestick"
      },
      {
         "datasource": "TimescaleDB-RO",
         "fieldConfig": {
            "defaults": {
               "unit": "short"
            },
            "overrides": [
               {
                  "matcher": {
                     "id": "byName",
                     "options": "å‘Šè­¦ä¸‹é™çº¿"
                  },
                  "properties": [
                     {
                        "id": "color",
                        "value": {
                           "fixedColor": "#FF9830",
                           "mode": "fixed"
                        }
                     },
                     {
                        "id": "custom.drawStyle",
                        "value": "line"
                     },
                     {
                        "id": "custom.lineWidth",
                        "value": 2
                     },
                     {
                        "id": "custom.lineInterpolation",
                        "value": "linear"
                     },
                     {
                        "id": "custom.fillOpacity",
                        "value": 0
                     },
                     {
                        "id": "custom.showPoints",
                        "value": "never"
                     },
                     {
                        "id": "custom.axisPlacement",
                        "value": "right"
                     }
                  ]
               },
               {
                  "matcher": {
                     "id": "byName",
                     "options": "å‘Šè­¦ä¸Šé™çº¿"
                  },
                  "properties": [
                     {
                        "id": "color",
                        "value": {
                           "fixedColor": "#E02F44",
                           "mode": "fixed"
                        }
                     },
                     {
                        "id": "custom.drawStyle",
                        "value": "line"
                     },
                     {
                        "id": "custom.lineWidth",
                        "value": 2
                     },
                     {
                        "id": "custom.lineInterpolation",
                        "value": "linear"
                     },
                     {
                        "id": "custom.fillOpacity",
                        "value": 0
                     },
                     {
                        "id": "custom.showPoints",
                        "value": "never"
                     },
                     {
                        "id": "custom.axisPlacement",
                        "value": "right"
                     }
                  ]
               }
            ]
         },
         "gridPos": {
            "h": 10,
            "w": 16,
            "x": 8,
            "y": 24
         },
         "id": 17,
         "options": {
            "candleStyle": "candles",
            "colorStrategy": "open-close",
            "colors": {
               "down": "#2D7D46",
               "up": "#73BF69"
            },
            "fields": {
               "close": "close",
               "high": "high",
               "low": "low",
               "open": "open"
            },
            "includeAllFields": true,
            "legend": {
               "calcs": [ ],
               "displayMode": "list",
               "placement": "bottom"
            },
            "mode": "candles",
            "tooltip": {
               "hoverProximity": 80,
               "maxHeight": 600,
               "maxWidth": 600,
               "mode": "single",
               "sort": "none"
            }
         },
         "targets": [
            {
               "format": "table",
               "rawQuery": true,
               "rawSql": "WITH tw AS (\n  SELECT '${__from:date:iso}'::timestamptz AS from_ts, LEAST('${__to:date:iso}'::timestamptz, now()) AS to_ts\n), base AS (\n  SELECT CASE ${agg:sqlstring}\n           WHEN '5min' THEN to_timestamp(floor(extract(epoch FROM m.ingest_ts) / 300) * 300)\n           ELSE date_trunc(CASE ${agg:sqlstring}\n                  WHEN 'hour' THEN 'hour'\n                  WHEN 'day' THEN 'day'\n                  WHEN 'month' THEN 'month'\n                  ELSE 'hour' END, m.ingest_ts)\n         END AS bucket_ts,\n         m.ingest_ts,\n         m.value_num\n  FROM metric_sample m\n  JOIN tw ON true\n  WHERE m.plant_id = ${plant_id:sqlstring}\n    AND m.metric = ${metric:sqlstring}\n    AND EXISTS (\n      SELECT 1 FROM metric_dict md\n      WHERE md.metric = m.metric\n        AND md.visible IS TRUE\n    )\n    AND m.point_id = ${outlet_point_id:sqlstring}\n    AND m.ingest_ts BETWEEN tw.from_ts AND tw.to_ts\n), ohlc AS (\n  SELECT bucket_ts,\n         CASE ${agg:sqlstring}\n           WHEN '5min' THEN bucket_ts + interval '5 minutes'\n           WHEN 'hour' THEN bucket_ts + interval '1 hour'\n           WHEN 'day' THEN bucket_ts + interval '1 day'\n           WHEN 'month' THEN bucket_ts + interval '1 month'\n           ELSE bucket_ts + interval '1 hour'\n         END AS bucket_end,\n         (array_agg(value_num ORDER BY ingest_ts ASC))[1] AS open,\n         max(value_num) AS high,\n         min(value_num) AS low,\n         (array_agg(value_num ORDER BY ingest_ts DESC))[1] AS close\n  FROM base\n  GROUP BY bucket_ts\n)\nSELECT (bucket_ts + ((bucket_end - bucket_ts) / 2.0)) AS \"time\",\n       COALESCE(open, close) AS open,\n       high,\n       low,\n       close\nFROM ohlc\nORDER BY \"time\";",
               "refId": "A"
            },
            {
               "format": "time_series",
               "rawQuery": true,
               "rawSql": "WITH tw AS (\n  SELECT '${__from:date:iso}'::timestamptz AS from_ts,\n         LEAST('${__to:date:iso}'::timestamptz, now()) AS to_ts\n), alarm AS (\n  SELECT md.alarm_low::double precision AS alarm_low,\n         md.alarm_high::double precision AS alarm_high\n  FROM metric_dict md\n  WHERE md.metric = ${metric:sqlstring}\n    AND md.visible IS TRUE\n  LIMIT 1\n)\nSELECT tw.from_ts AS \"time\",\n       alarm.alarm_low AS \"å‘Šè­¦ä¸‹é™çº¿\",\n       alarm.alarm_high AS \"å‘Šè­¦ä¸Šé™çº¿\"\nFROM tw\nJOIN alarm ON true\nUNION ALL\nSELECT tw.to_ts AS \"time\",\n       alarm.alarm_low AS \"å‘Šè­¦ä¸‹é™çº¿\",\n       alarm.alarm_high AS \"å‘Šè­¦ä¸Šé™çº¿\"\nFROM tw\nJOIN alarm ON true\nORDER BY 1;",
               "refId": "B"
            }
         ],
         "title": "å‡ºå£èœ¡çƒ›å›¾ï¼ˆ${metric:text}ï½œå‘Šè­¦ä¸‹é™:${metric_alarm_low:text} ä¸Šé™:${metric_alarm_high:text}ï¼‰",
         "type": "candlestick"
      },
      {
         "datasource": "TimescaleDB-RO",
         "fieldConfig": {
            "defaults": {
               "custom": {
                  "drawStyle": "line",
                  "fillOpacity": 30,
                  "lineInterpolation": "smooth",
                  "lineWidth": 2,
                  "showPoints": "never",
                  "spanNulls": true
               }
            },
            "overrides": [
               {
                  "matcher": {
                     "id": "byName",
                     "options": "å…¥å£"
                  },
                  "properties": [
                     {
                        "id": "color",
                        "value": {
                           "fixedColor": "#F2CC0C",
                           "mode": "fixed"
                        }
                     }
                  ]
               },
               {
                  "matcher": {
                     "id": "byName",
                     "options": "å‡ºå£"
                  },
                  "properties": [
                     {
                        "id": "color",
                        "value": {
                           "fixedColor": "#73BF69",
                           "mode": "fixed"
                        }
                     }
                  ]
               }
            ]
         },
         "gridPos": {
            "h": 6,
            "w": 16,
            "x": 8,
            "y": 34
         },
         "id": 14,
         "options": {
            "legend": {
               "calcs": [ ],
               "displayMode": "list",
               "placement": "bottom"
            },
            "tooltip": {
               "mode": "multi",
               "sort": "none"
            }
         },
         "targets": [
            {
               "format": "time_series",
               "rawQuery": true,
               "rawSql": "WITH base AS (\n  SELECT m.ingest_ts,\n         m.point_id,\n         m.value_num,\n         row_number() OVER (PARTITION BY m.point_id ORDER BY m.ingest_ts) AS rn,\n         count(*) OVER (PARTITION BY m.point_id) AS total_rows\n  FROM metric_sample m\n  WHERE m.plant_id = ${plant_id:sqlstring}\n    AND m.metric = ${metric:sqlstring}\n    AND EXISTS (\n      SELECT 1 FROM metric_dict md\n      WHERE md.metric = m.metric\n        AND md.visible IS TRUE\n    )\n    AND m.point_id IN (${inlet_point_id:sqlstring}, ${outlet_point_id:sqlstring})\n), sampled AS (\n  SELECT ingest_ts AS \"time\", point_id, value_num AS value\n  FROM base\n  WHERE total_rows <= 2000\n     OR rn = 1\n     OR rn = total_rows\n     OR (rn % GREATEST(1::bigint, ceil(total_rows / 1000.0)::bigint)) = 0\n)\nSELECT s.\"time\",\n       CASE WHEN s.point_id = ${inlet_point_id:sqlstring} THEN 'å…¥å£' ELSE 'å‡ºå£' END AS metric,\n       s.value\nFROM sampled s\nORDER BY s.\"time\";",
               "refId": "A"
            }
         ],
         "title": "æ—¶é—´èŒƒå›´å¯¼èˆªï¼ˆå…¨é‡ï¼šæ‹–æ‹½ç¼©å° / åŒå‡»æ¢å¤ï¼‰",
         "type": "timeseries"
      },
      {
         "gridPos": {
            "h": 2,
            "w": 16,
            "x": 8,
            "y": 40
         },
         "id": 15,
         "options": {
            "content": "æ“ä½œï¼šå³ä¾§å¯¼èˆªå›¾**æ‹–æ‹½=ç¼©å°**ï¼Œ**åŒå‡»å›¾è¡¨=æ¢å¤åˆ°å½“å‰çª—å£**ï¼›èœ¡çƒ›å›¾ä¸Šæ–¹å¯å¿«æ·åˆ‡æ¢æŒ‡æ ‡ä¸å‘¨æœŸã€‚æ³¨æ„ï¼šå®æ—¶å¡ç‰‡æŒ‰è®¾å¤‡ä¸ŠæŠ¥å‘¨æœŸåˆ¤æ–­æ–°é²œåº¦ï¼Œè¶…è¿‡ **2 Ã— report_interval_sec** æœªæ”¶åˆ°æ–°æ•°æ®å°†æ˜¾ç¤º **No data**ã€‚å…¥å£/å‡ºå£å·²æ‹†åˆ†ä¸ºä¸¤å¼ èœ¡çƒ›å›¾ï¼Œå‡ä½¿ç”¨çœŸå® OHLCï¼ˆå¼€é«˜ä½æ”¶ï¼‰ï¼ŒæŒ‰è‡ªç„¶å‘¨æœŸå¯¹é½ï¼ˆå«è‡ªç„¶æœˆï¼›æ”¯æŒ 5 åˆ†é’Ÿï¼‰ã€‚å‘¨æœŸåˆ‡æ¢ä»…æ”¹å˜èœ¡çƒ›å›¾èšåˆç²’åº¦ï¼Œä¸æ”¹å˜å½“å‰æ—¶é—´èŒƒå›´ï¼›æ—¶é—´èŒƒå›´å¯¼èˆªå›ºå®šä½¿ç”¨è¯¥æŒ‡æ ‡å…¨é‡ ingest_tsï¼ˆæœ€å°åˆ°æœ€å¤§ï¼‰ã€‚å‘Šè­¦ä¿¡æ¯è¡¨å·²åˆ é™¤ï¼Œå‘Šè­¦ä¸Šä¸‹é™é€šè¿‡èœ¡çƒ›å›¾å åŠ çº¿å’Œæ ‡é¢˜æ–‡æœ¬å±•ç¤ºã€‚ä¸‹æ–¹å‡å€¼å°å›¾ä½¿ç”¨åˆ†é’Ÿçº¿ï¼Œä¸å—â€œå‘¨æœŸâ€åˆ‡æ¢å½±å“ï¼Œå¹¶æ”¯æŒåˆ†é¡µï¼ˆæ¯é¡µ 5 é¡¹ï¼‰ï¼›æ•°æ®èŒƒå›´å›ºå®šä¸º**æœ€è¿‘24å°æ—¶**ã€‚å¿«é€Ÿæ”¾å¤§/æ¢å¤ï¼š [æœ€è¿‘24h](/d/iot-v1-plant-monitor?var-plant_id=${plant_id:percentencode}&var-metric=${metric:percentencode}&var-agg=${agg:percentencode}&from=now-24h&to=now) Â· [æœ€è¿‘7d](/d/iot-v1-plant-monitor?var-plant_id=${plant_id:percentencode}&var-metric=${metric:percentencode}&var-agg=${agg:percentencode}&from=now-7d&to=now) Â· [æœ€è¿‘14d](/d/iot-v1-plant-monitor?var-plant_id=${plant_id:percentencode}&var-metric=${metric:percentencode}&var-agg=${agg:percentencode}&from=now-14d&to=now) Â· [æœ€è¿‘30d](/d/iot-v1-plant-monitor?var-plant_id=${plant_id:percentencode}&var-metric=${metric:percentencode}&var-agg=${agg:percentencode}&from=now-30d&to=now)",
            "mode": "markdown"
         },
         "title": "æ—¶é—´èŒƒå›´æ§åˆ¶",
         "type": "text"
      }
   ],
   "refresh": "30s",
   "schemaVersion": 39,
   "tags": [
      "iot",
      "monitor",
      "plant"
   ],
   "templating": {
      "list": [
         {
            "current": {
               "selected": true,
               "text": "plant_cqbb_liaoning53",
               "value": "plant_cqbb_liaoning53"
            },
            "datasource": "TimescaleDB-RO",
            "definition": "SELECT plant_id FROM plant ORDER BY plant_id;",
            "hide": 0,
            "includeAll": false,
            "label": "æ°´å‚",
            "multi": false,
            "name": "plant_id",
            "options": [ ],
            "query": "SELECT plant_id FROM plant ORDER BY plant_id;",
            "refresh": 1,
            "regex": "",
            "skipUrlSync": false,
            "sort": 1,
            "type": "query"
         },
         {
            "current": {
               "selected": true,
               "text": "pt_cqbb_liaoning53_inlet",
               "value": "pt_cqbb_liaoning53_inlet"
            },
            "datasource": "TimescaleDB-RO",
            "definition": "SELECT point_id FROM point WHERE plant_id = ${plant_id:sqlstring} AND point_type = 'inlet' ORDER BY point_id LIMIT 1;",
            "hide": 2,
            "includeAll": false,
            "multi": false,
            "name": "inlet_point_id",
            "options": [ ],
            "query": "SELECT point_id FROM point WHERE plant_id = ${plant_id:sqlstring} AND point_type = 'inlet' ORDER BY point_id LIMIT 1;",
            "refresh": 2,
            "regex": "",
            "skipUrlSync": true,
            "sort": 1,
            "type": "query"
         },
         {
            "current": {
               "selected": true,
               "text": "pt_cqbb_liaoning53_outlet",
               "value": "pt_cqbb_liaoning53_outlet"
            },
            "datasource": "TimescaleDB-RO",
            "definition": "SELECT point_id FROM point WHERE plant_id = ${plant_id:sqlstring} AND point_type = 'outlet' ORDER BY point_id LIMIT 1;",
            "hide": 2,
            "includeAll": false,
            "multi": false,
            "name": "outlet_point_id",
            "options": [ ],
            "query": "SELECT point_id FROM point WHERE plant_id = ${plant_id:sqlstring} AND point_type = 'outlet' ORDER BY point_id LIMIT 1;",
            "refresh": 2,
            "regex": "",
            "skipUrlSync": true,
            "sort": 1,
            "type": "query"
         },
         {
            "current": {
               "selected": true,
               "text": "æ¸©åº¦",
               "value": "temperature"
            },
            "datasource": "TimescaleDB-RO",
            "definition": "SELECT md.metric AS __value, COALESCE(md.display_name, md.metric) AS __text FROM metric_dict md WHERE md.visible IS TRUE AND NULLIF(btrim(md.metric), '') IS NOT NULL ORDER BY md.metric;",
            "hide": 2,
            "includeAll": false,
            "label": "å½“å‰æŒ‡æ ‡",
            "multi": false,
            "name": "metric",
            "options": [ ],
            "query": "SELECT md.metric AS __value, COALESCE(md.display_name, md.metric) AS __text FROM metric_dict md WHERE md.visible IS TRUE AND NULLIF(btrim(md.metric), '') IS NOT NULL ORDER BY md.metric;",
            "refresh": 2,
            "regex": "",
            "skipUrlSync": false,
            "sort": 1,
            "type": "query"
         },
         {
            "current": {
               "selected": true,
               "text": "hour",
               "value": "hour"
            },
            "hide": 2,
            "includeAll": false,
            "label": "å‘¨æœŸ",
            "multi": false,
            "name": "agg",
            "options": [
               {
                  "selected": false,
                  "text": "5min",
                  "value": "5min"
               },
               {
                  "selected": true,
                  "text": "hour",
                  "value": "hour"
               },
               {
                  "selected": false,
                  "text": "day",
                  "value": "day"
               },
               {
                  "selected": false,
                  "text": "month",
                  "value": "month"
               }
            ],
            "query": "5min,hour,day,month",
            "skipUrlSync": false,
            "type": "custom"
         },
         {
            "current": {
               "selected": true,
               "text": "æ— ",
               "value": "æ— "
            },
            "datasource": "TimescaleDB-RO",
            "definition": "SELECT COALESCE(md.alarm_low::text, 'æ— ') AS __text, COALESCE(md.alarm_low::text, 'NaN') AS __value FROM metric_dict md WHERE md.metric = ${metric:sqlstring} AND md.visible IS TRUE LIMIT 1;",
            "hide": 2,
            "includeAll": false,
            "multi": false,
            "name": "metric_alarm_low",
            "options": [ ],
            "query": "SELECT COALESCE(md.alarm_low::text, 'æ— ') AS __text, COALESCE(md.alarm_low::text, 'NaN') AS __value FROM metric_dict md WHERE md.metric = ${metric:sqlstring} AND md.visible IS TRUE LIMIT 1;",
            "refresh": 2,
            "regex": "",
            "skipUrlSync": true,
            "sort": 1,
            "type": "query"
         },
         {
            "current": {
               "selected": true,
               "text": "æ— ",
               "value": "æ— "
            },
            "datasource": "TimescaleDB-RO",
            "definition": "SELECT COALESCE(md.alarm_high::text, 'æ— ') AS __text, COALESCE(md.alarm_high::text, 'NaN') AS __value FROM metric_dict md WHERE md.metric = ${metric:sqlstring} AND md.visible IS TRUE LIMIT 1;",
            "hide": 2,
            "includeAll": false,
            "multi": false,
            "name": "metric_alarm_high",
            "options": [ ],
            "query": "SELECT COALESCE(md.alarm_high::text, 'æ— ') AS __text, COALESCE(md.alarm_high::text, 'NaN') AS __value FROM metric_dict md WHERE md.metric = ${metric:sqlstring} AND md.visible IS TRUE LIMIT 1;",
            "refresh": 2,
            "regex": "",
            "skipUrlSync": true,
            "sort": 1,
            "type": "query"
         },
         {
            "current": {
               "selected": true,
               "text": "1",
               "value": "1"
            },
            "datasource": "TimescaleDB-RO",
            "definition": "SELECT gs::text AS __text, gs::text AS __value FROM generate_series(1, GREATEST(1, ((SELECT COUNT(*) FROM metric_dict md WHERE md.visible IS TRUE AND NULLIF(btrim(md.metric), '') IS NOT NULL) + 4) / 5)) AS gs;",
            "hide": 2,
            "includeAll": false,
            "label": "å‡å€¼é¡µ",
            "multi": false,
            "name": "mean_page",
            "options": [ ],
            "query": "SELECT gs::text AS __text, gs::text AS __value FROM generate_series(1, GREATEST(1, ((SELECT COUNT(*) FROM metric_dict md WHERE md.visible IS TRUE AND NULLIF(btrim(md.metric), '') IS NOT NULL) + 4) / 5)) AS gs;",
            "refresh": 1,
            "regex": "",
            "skipUrlSync": false,
            "sort": 1,
            "type": "query"
         },
         {
            "current": {
               "selected": true,
               "text": "1",
               "value": "1"
            },
            "datasource": "TimescaleDB-RO",
            "definition": "SELECT GREATEST(1, ((COUNT(*) + 4) / 5))::text AS __text, GREATEST(1, ((COUNT(*) + 4) / 5))::text AS __value FROM metric_dict md WHERE md.visible IS TRUE AND NULLIF(btrim(md.metric), '') IS NOT NULL;",
            "hide": 2,
            "includeAll": false,
            "multi": false,
            "name": "mean_page_total",
            "options": [ ],
            "query": "SELECT GREATEST(1, ((COUNT(*) + 4) / 5))::text AS __text, GREATEST(1, ((COUNT(*) + 4) / 5))::text AS __value FROM metric_dict md WHERE md.visible IS TRUE AND NULLIF(btrim(md.metric), '') IS NOT NULL;",
            "refresh": 2,
            "regex": "",
            "skipUrlSync": true,
            "sort": 1,
            "type": "query"
         },
         {
            "current": {
               "selected": true,
               "text": "1",
               "value": "1"
            },
            "datasource": "TimescaleDB-RO",
            "definition": "SELECT GREATEST(1, (${mean_page:sqlstring})::int - 1)::text AS __text, GREATEST(1, (${mean_page:sqlstring})::int - 1)::text AS __value;",
            "hide": 2,
            "includeAll": false,
            "multi": false,
            "name": "mean_page_prev",
            "options": [ ],
            "query": "SELECT GREATEST(1, (${mean_page:sqlstring})::int - 1)::text AS __text, GREATEST(1, (${mean_page:sqlstring})::int - 1)::text AS __value;",
            "refresh": 2,
            "regex": "",
            "skipUrlSync": true,
            "sort": 1,
            "type": "query"
         },
         {
            "current": {
               "selected": true,
               "text": "1",
               "value": "1"
            },
            "datasource": "TimescaleDB-RO",
            "definition": "SELECT LEAST((${mean_page_total:sqlstring})::int, (${mean_page:sqlstring})::int + 1)::text AS __text, LEAST((${mean_page_total:sqlstring})::int, (${mean_page:sqlstring})::int + 1)::text AS __value;",
            "hide": 2,
            "includeAll": false,
            "multi": false,
            "name": "mean_page_next",
            "options": [ ],
            "query": "SELECT LEAST((${mean_page_total:sqlstring})::int, (${mean_page:sqlstring})::int + 1)::text AS __text, LEAST((${mean_page_total:sqlstring})::int, (${mean_page:sqlstring})::int + 1)::text AS __value;",
            "refresh": 2,
            "regex": "",
            "skipUrlSync": true,
            "sort": 1,
            "type": "query"
         },
         {
            "current": {
               "selected": true,
               "text": "All",
               "value": "$__all"
            },
            "datasource": "TimescaleDB-RO",
            "definition": "WITH md_base AS (\n  SELECT md.metric,\n         COALESCE(NULLIF(btrim(md.display_name), ''), md.metric) AS metric_text\n  FROM metric_dict md\n  WHERE md.visible IS TRUE\n    AND NULLIF(btrim(md.metric), '') IS NOT NULL\n), md_named AS (\n  SELECT metric,\n         metric_text,\n         COUNT(*) OVER (PARTITION BY metric_text) AS text_dup_count\n  FROM md_base\n)\nSELECT metric AS __value,\n       CASE\n         WHEN text_dup_count > 1 THEN metric_text || ' [' || metric || ']'\n         ELSE metric_text\n       END AS __text\nFROM md_named\nORDER BY metric\nLIMIT 5 OFFSET (((${mean_page:sqlstring})::int - 1) * 5);",
            "hide": 2,
            "includeAll": true,
            "multi": true,
            "name": "mean_metric_page",
            "options": [ ],
            "query": "WITH md_base AS (\n  SELECT md.metric,\n         COALESCE(NULLIF(btrim(md.display_name), ''), md.metric) AS metric_text\n  FROM metric_dict md\n  WHERE md.visible IS TRUE\n    AND NULLIF(btrim(md.metric), '') IS NOT NULL\n), md_named AS (\n  SELECT metric,\n         metric_text,\n         COUNT(*) OVER (PARTITION BY metric_text) AS text_dup_count\n  FROM md_base\n)\nSELECT metric AS __value,\n       CASE\n         WHEN text_dup_count > 1 THEN metric_text || ' [' || metric || ']'\n         ELSE metric_text\n       END AS __text\nFROM md_named\nORDER BY metric\nLIMIT 5 OFFSET (((${mean_page:sqlstring})::int - 1) * 5);",
            "refresh": 1,
            "regex": "",
            "skipUrlSync": true,
            "sort": 1,
            "type": "query"
         },
         {
            "current": {
               "selected": true,
               "text": "All",
               "value": "$__all"
            },
            "datasource": "TimescaleDB-RO",
            "definition": "SELECT md.metric AS __value, COALESCE(md.display_name, md.metric) AS __text FROM metric_dict md WHERE md.visible IS TRUE AND NULLIF(btrim(md.metric), '') IS NOT NULL ORDER BY md.metric;",
            "hide": 2,
            "includeAll": true,
            "multi": true,
            "name": "metric_cards",
            "options": [ ],
            "query": "SELECT md.metric AS __value, COALESCE(md.display_name, md.metric) AS __text FROM metric_dict md WHERE md.visible IS TRUE AND NULLIF(btrim(md.metric), '') IS NOT NULL ORDER BY md.metric;",
            "refresh": 1,
            "regex": "",
            "skipUrlSync": false,
            "sort": 1,
            "type": "query"
         },
         {
            "current": {
               "selected": true,
               "text": "",
               "value": ""
            },
            "datasource": "TimescaleDB-RO",
            "definition": "WITH md_base AS (\n  SELECT md.metric,\n         COALESCE(NULLIF(btrim(md.display_name), ''), md.metric) AS metric_text\n  FROM metric_dict md\n  WHERE md.visible IS TRUE\n    AND NULLIF(btrim(md.metric), '') IS NOT NULL\n), md_named AS (\n  SELECT metric,\n         metric_text,\n         COUNT(*) OVER (PARTITION BY metric_text) AS text_dup_count\n  FROM md_base\n), links AS (\n  SELECT '[' || CASE WHEN text_dup_count > 1 THEN metric_text || ' [' || metric || ']' ELSE metric_text END || '](/d/iot-v1-plant-monitor?var-plant_id=${plant_id:percentencode}&var-metric=' || metric || '&var-agg=${agg:percentencode}&var-mean_page=${mean_page:percentencode}&from=${__from}&to=${__to})' AS link\n  FROM md_named\n  ORDER BY metric\n)\nSELECT COALESCE(string_agg(link, ' Â· '), 'æ— å¯é€‰æŒ‡æ ‡') AS __text,\n       COALESCE(string_agg(link, ' Â· '), 'æ— å¯é€‰æŒ‡æ ‡') AS __value\nFROM links;",
            "hide": 2,
            "includeAll": false,
            "multi": false,
            "name": "metric_switch_md",
            "options": [ ],
            "query": "WITH md_base AS (\n  SELECT md.metric,\n         COALESCE(NULLIF(btrim(md.display_name), ''), md.metric) AS metric_text\n  FROM metric_dict md\n  WHERE md.visible IS TRUE\n    AND NULLIF(btrim(md.metric), '') IS NOT NULL\n), md_named AS (\n  SELECT metric,\n         metric_text,\n         COUNT(*) OVER (PARTITION BY metric_text) AS text_dup_count\n  FROM md_base\n), links AS (\n  SELECT '[' || CASE WHEN text_dup_count > 1 THEN metric_text || ' [' || metric || ']' ELSE metric_text END || '](/d/iot-v1-plant-monitor?var-plant_id=${plant_id:percentencode}&var-metric=' || metric || '&var-agg=${agg:percentencode}&var-mean_page=${mean_page:percentencode}&from=${__from}&to=${__to})' AS link\n  FROM md_named\n  ORDER BY metric\n)\nSELECT COALESCE(string_agg(link, ' Â· '), 'æ— å¯é€‰æŒ‡æ ‡') AS __text,\n       COALESCE(string_agg(link, ' Â· '), 'æ— å¯é€‰æŒ‡æ ‡') AS __value\nFROM links;",
            "refresh": 2,
            "regex": "",
            "skipUrlSync": true,
            "sort": 1,
            "type": "query"
         }
      ]
   },
   "time": {
      "from": "now-24h",
      "to": "now"
   },
   "timepicker": {
      "hidden": true,
      "refresh_intervals": [
         "30s",
         "1m",
         "5m",
         "15m",
         "30m",
         "1h"
      ],
      "time_options": [
         "1h",
         "6h",
         "12h",
         "24h",
         "7d",
         "30d"
      ]
   },
   "timezone": "browser",
   "title": "IoT V1 Â· Plant Monitor",
   "uid": "iot-v1-plant-monitor",
   "version": 85
}
